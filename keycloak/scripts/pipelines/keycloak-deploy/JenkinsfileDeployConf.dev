#!groovy

node('general-dev') {

	currentBuild.result = "SUCCESS"

	try {

		stage('checkout')
		{
			sh('rm -rf sunbird-auth')
			sh('git clone https://github.com/ahghatol/sunbird-auth.git')
		}

		stage('Build'){
			sh('cd sunbird-auth/keycloak/scripts/ansible && ansible-playbook -i inventories/dev  keycloak.yml --limit keycloak --tags deploy-conf --vault-password-file /run/secrets/vault-pass -vvv')
		}
	}
	catch (err) {
		currentBuild.result = "FAILURE"
		throw err
	}
}
